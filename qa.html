<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé—®ç­” Â· é»„æ™ºæ·³</title>
    <link rel="stylesheet" href="/test-QA/style.css">
</head>
<body>
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- å·¦ä¾§å›ºå®šæ  -->
        <aside class="sidebar">
            <div class="sidebar-content">
                <!-- å¤´åƒ -->
                <div class="avatar-section">
                    <div class="avatar">
                        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="100" cy="100" r="100" fill="#1A1F35"/>
                            <circle cx="100" cy="80" r="30" fill="#00D9FF"/>
                            <path d="M 30 180 Q 30 140 100 140 Q 170 140 170 180 L 170 200 L 30 200 Z" fill="#00D9FF"/>
                        </svg>
                    </div>
                    <h2 class="name">é»„æ™ºæ·³</h2>
                    <p class="title">å…¨æ ˆå¼€å‘è€…</p>
                </div>

                <!-- æ ‡ç­¾ -->
                <div class="tags-section">
                    <div class="tag">AIé—®ç­”</div>
                    <div class="tag">æ™ºèƒ½åŠ©æ‰‹</div>
                    <div class="tag">æŠ€æœ¯å’¨è¯¢</div>
                </div>

                <!-- ç¤¾äº¤å›¾æ ‡ -->
                <div class="social-icons">
                    <a href="https://github.com" target="_blank" class="social-icon github" title="GitHub">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                    <a href="#" class="social-icon qq" title="QQ">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 5.64 2 10c0 2.42 1.12 4.6 2.92 6.06L4 22l6.14-1.02C10.96 21.66 11.46 21.7 12 21.7c5.52 0 10-3.64 10-8.1S17.52 2 12 2zm0 14.5c-.83 0-1.64-.12-2.41-.35l-.3-.09-2.17.36.46-2.11-.1-.3C6.5 13.2 6 12.1 6 11c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6z"/>
                        </svg>
                    </a>
                    <a href="mailto:your.email@example.com" class="social-icon email" title="é‚®ç®±">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                    </a>
                    <a href="#" class="social-icon wechat" title="å¾®ä¿¡">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.488-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18 0 .653-.52 1.18-1.162 1.18-.642 0-1.162-.527-1.162-1.18 0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18 0 .653-.52 1.18-1.162 1.18-.642 0-1.162-.527-1.162-1.18 0-.651.52-1.18 1.162-1.18zm5.34 2.166c-1.693 1.361-2.445 3.294-1.81 5.115.078.223.177.44.296.65a9.148 9.148 0 0 1-2.717 2.466.59.59 0 0 1-.665.213l-1.481.39c-.07.019-.141.048-.213.048-.163 0-.295-.13-.295-.29a.326.326 0 0 1 .054-.167l1.114-1.903a.864.864 0 0 1 .098-.717 8.952 8.952 0 0 1-.403-2.837c0-4.754 3.891-8.342 8.691-8.342.276 0 .543.027.811.05-1.693 4.057-5.873 7.12-9.783 7.12zm-1.127 3.024c.519 0 .94.427.94.953 0 .527-.421.953-.94.953-.519 0-.94-.426-.94-.953 0-.526.421-.953.94-.953zm4.416 0c.519 0 .94.427.94.953 0 .527-.421.953-.94.953-.519 0-.94-.426-.94-.953 0-.526.421-.953.94-.953z"/>
                        </svg>
                    </a>
                </div>

                <!-- æˆ‘çš„å°å°å·¥å…·ç®± -->
                <div class="toolbox-section">
                    <h3 class="toolbox-title">æˆ‘çš„å°å°å·¥å…·ç®±</h3>
                    <div class="toolbox-items">
                        <a href="blog-list.html" class="toolbox-item">
                            <span class="toolbox-icon">ğŸ“</span>
                            <span class="toolbox-label">åšå®¢åˆ—è¡¨</span>
                        </a>
                        <a href="index.html" class="toolbox-item">
                            <span class="toolbox-icon">ğŸ </span>
                            <span class="toolbox-label">è¿”å›ä¸»é¡µ</span>
                        </a>
                        <a href="#" class="toolbox-item">
                            <span class="toolbox-icon">ğŸ”§</span>
                            <span class="toolbox-label">å·¥å…·</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <div class="card qa-card">
                <div class="card-header">
                    <h3 class="card-title">AIé—®ç­”åŠ©æ‰‹</h3>
                    <a href="index.html" class="card-link">â† è¿”å›ä¸»é¡µ</a>
                </div>

                <!-- é—®ç­”åŒºåŸŸ -->
                <div class="qa-container">
                    <!-- é—®é¢˜è¾“å…¥åŒºåŸŸ -->
                    <div class="qa-input-section">
                        <form id="qaForm" class="qa-form">
                            <div class="form-group">
                                <label for="questionInput">è¾“å…¥ä½ çš„é—®é¢˜</label>
                                <textarea 
                                    id="questionInput" 
                                    name="question" 
                                    rows="4" 
                                    placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„é—®é¢˜ï¼ŒAIåŠ©æ‰‹ä¼šä¸ºä½ è§£ç­”...ï¼ˆæŒ‰ Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œï¼‰"
                                    required></textarea>
                            </div>
                            <div class="qa-form-actions">
                                <button type="button" class="btn btn-hunter" id="hunterModeBtn">
                                    ğŸ¯ çŒå¤´æ¨¡å¼
                                </button>
                                <button type="submit" class="btn btn-primary" id="submitBtn">
                                    <span id="submitText">æäº¤é—®é¢˜</span>
                                    <span id="loadingText" style="display: none;">æ€è€ƒä¸­...</span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- å›ç­”æ˜¾ç¤ºåŒºåŸŸ -->
                    <div class="qa-answer-section" id="answerSection" style="display: none;">
                        <div class="answer-header">
                            <h4>å›ç­”</h4>
                        </div>
                        <div class="answer-content" id="answerContent">
                            <!-- å›ç­”å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                        </div>
                    </div>

                    <!-- å†å²è®°å½• -->
                    <div class="qa-history-section">
                        <div class="history-header">
                            <h4>å†å²é—®ç­”</h4>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn-clear" id="clearConversationBtn">æ¸…ç©ºå¯¹è¯</button>
                                <button class="btn-clear" id="clearHistoryBtn" style="display: none;">æ¸…ç©ºå†å²</button>
                            </div>
                        </div>
                        <div class="history-list" id="historyList">
                            <!-- å†å²é—®ç­”è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- è‡ªå®šä¹‰æ¨¡æ€å¼¹çª— -->
    <div id="customModal" class="custom-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h4 id="modalTitle">æç¤º</h4>
                <span class="custom-modal-close" id="modalClose">&times;</span>
            </div>
            <div class="custom-modal-body">
                <p id="modalMessage"></p>
            </div>
            <div class="custom-modal-footer" id="modalFooter">
                <!-- æŒ‰é’®å°†åŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>

    <script src="/test-QA/script.js"></script>
    <script>
        // ============================================
        // DeepSeek APIé…ç½®åŒºåŸŸ
        // ============================================
        // DeepSeek API åœ°å€ï¼ˆæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼šhttps://api.deepseek.comï¼‰
        const API_URL = 'https://api.deepseek.com/v1/chat/completions';
        
        // TODO: è¯·æ›¿æ¢ä¸ºä½ çš„å®é™… DeepSeek API Key
        const API_KEY = 'sk-fb900c70dc0d4edf9fc52fe7678c3106'; // è¯·æ›¿æ¢ä¸ºä½ çš„å®é™…API Key
        
        // ============================================

        const qaForm = document.getElementById('qaForm');
        const questionInput = document.getElementById('questionInput');
        const answerSection = document.getElementById('answerSection');
        const answerContent = document.getElementById('answerContent');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const loadingText = document.getElementById('loadingText');
        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');

        // è‡ªå®šä¹‰å¼¹çª—å…ƒç´ 
        const customModal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalFooter = document.getElementById('modalFooter');
        const modalClose = document.getElementById('modalClose');

        // è‡ªå®šä¹‰ alert å‡½æ•°
        function customAlert(message, title = 'æç¤º') {
            return new Promise((resolve) => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalFooter.innerHTML = '<button class="btn btn-primary" id="modalOkBtn">ç¡®å®š</button>';
                
                customModal.style.display = 'flex';
                
                const okBtn = document.getElementById('modalOkBtn');
                const closeModal = () => {
                    customModal.style.display = 'none';
                    resolve();
                };
                
                okBtn.onclick = closeModal;
                modalClose.onclick = closeModal;
                customModal.onclick = (e) => {
                    if (e.target === customModal) {
                        closeModal();
                    }
                };
            });
        }

        // è‡ªå®šä¹‰ confirm å‡½æ•°
        function customConfirm(message, title = 'ç¡®è®¤') {
            return new Promise((resolve) => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalFooter.innerHTML = `
                    <button class="btn btn-secondary" id="modalCancelBtn">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="modalConfirmBtn">ç¡®å®š</button>
                `;
                
                customModal.style.display = 'flex';
                
                const confirmBtn = document.getElementById('modalConfirmBtn');
                const cancelBtn = document.getElementById('modalCancelBtn');
                
                const closeModal = (result) => {
                    customModal.style.display = 'none';
                    resolve(result);
                };
                
                confirmBtn.onclick = () => closeModal(true);
                cancelBtn.onclick = () => closeModal(false);
                modalClose.onclick = () => closeModal(false);
                customModal.onclick = (e) => {
                    if (e.target === customModal) {
                        closeModal(false);
                    }
                };
            });
        }

        // å¯¹è¯å†å²æ•°ç»„ï¼ˆç”¨äºä¿æŒå¯¹è¯è®°å¿†ï¼‰
        // æ ¼å¼: [{ role: 'user'|'assistant'|'system', content: '...' }]
        let conversationHistory = [];

        // çŒå¤´æ¨¡å¼çŠ¶æ€
        let isHunterMode = false;

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å¯¹è¯å†å²
        function loadConversationHistory() {
            const saved = localStorage.getItem('qaConversationHistory');
            if (saved) {
                conversationHistory = JSON.parse(saved);
            } else {
                // åˆå§‹åŒ–å¯¹è¯å†å²ï¼ŒåŒ…å«ç³»ç»Ÿæ¶ˆæ¯
                conversationHistory = [
                    {
                        role: 'system',
                        content: 'You are a helpful assistant.'
                    }
                ];
            }
        }

        // ä¿å­˜å¯¹è¯å†å²åˆ°æœ¬åœ°å­˜å‚¨
        function saveConversationHistory() {
            localStorage.setItem('qaConversationHistory', JSON.stringify(conversationHistory));
        }

        // æ¸…ç©ºå¯¹è¯å†å²
        function clearConversationHistory() {
            conversationHistory = [
                {
                    role: 'system',
                    content: 'You are a helpful assistant.'
                }
            ];
            saveConversationHistory();
            // é€€å‡ºçŒå¤´æ¨¡å¼
            exitHunterMode();
        }

        // æ›´æ–°çŒå¤´æ¨¡å¼æŒ‰é’®çŠ¶æ€
        function updateHunterModeButton() {
            const hunterModeBtn = document.getElementById('hunterModeBtn');
            if (hunterModeBtn) {
                if (isHunterMode) {
                    hunterModeBtn.textContent = 'ğŸ¯ çŒå¤´æ¨¡å¼ä¸­';
                    hunterModeBtn.classList.add('hunter-mode-active');
                } else {
                    hunterModeBtn.textContent = 'ğŸ¯ çŒå¤´æ¨¡å¼';
                    hunterModeBtn.classList.remove('hunter-mode-active');
                }
            }
        }

        // é€€å‡ºçŒå¤´æ¨¡å¼
        function exitHunterMode() {
            isHunterMode = false;
            updateHunterModeButton();
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('qaHistory') || '[]');
            if (history.length > 0) {
                clearHistoryBtn.style.display = 'block';
                historyList.innerHTML = '';
                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-question">
                            <strong>Q${index + 1}:</strong> ${item.question}
                        </div>
                        <div class="history-answer">
                            <strong>A:</strong> ${item.answer}
                        </div>
                        <div class="history-time">${item.time}</div>
                    `;
                    historyList.appendChild(historyItem);
                });
            } else {
                clearHistoryBtn.style.display = 'none';
            }
        }

        // ä¿å­˜åˆ°å†å²è®°å½•
        function saveToHistory(question, answer) {
            const history = JSON.parse(localStorage.getItem('qaHistory') || '[]');
            const now = new Date();
            const timeString = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            history.unshift({
                question: question,
                answer: answer,
                time: timeString
            });
            
            // æœ€å¤šä¿å­˜20æ¡å†å²è®°å½•
            if (history.length > 20) {
                history.pop();
            }
            
            localStorage.setItem('qaHistory', JSON.stringify(history));
            loadHistory();
        }

        // è°ƒç”¨DeepSeek APIè·å–å›ç­”ï¼ˆä½¿ç”¨å¯¹è¯å†å²ä¿æŒè®°å¿†ï¼‰
        async function getAnswer(question, useHistory = true) {
            try {
                // å°†ç”¨æˆ·æ¶ˆæ¯æ·»åŠ åˆ°å¯¹è¯å†å²
                if (useHistory) {
                    conversationHistory.push({
                        role: 'user',
                        content: question
                    });
                } else {
                    // å¦‚æœä¸ä½¿ç”¨å†å²ï¼Œåˆ›å»ºä¸´æ—¶å¯¹è¯ï¼ˆç”¨äºçŒå¤´æ¨¡å¼ç­‰ï¼‰
                    conversationHistory = [
                        {
                            role: 'system',
                            content: 'You are a helpful assistant.'
                        },
                        {
                            role: 'user',
                            content: question
                        }
                    ];
                }

                // ============================================
                // DeepSeek APIè°ƒç”¨é…ç½®ï¼ˆæ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼‰
                // ============================================
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // DeepSeek API éœ€è¦ Authorization header
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        // DeepSeek æ¨¡å‹åç§°
                        model: 'deepseek-chat',
                        // å‘é€å®Œæ•´çš„å¯¹è¯å†å²ä»¥ä¿æŒè®°å¿†
                        messages: conversationHistory,
                        // å¯é€‰å‚æ•°
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}. ${errorData.error?.message || ''}`);
                }

                const data = await response.json();
                
                // ============================================
                // è§£æDeepSeek APIå“åº”
                // DeepSeek è¿”å›æ ¼å¼ä¸ OpenAI å…¼å®¹ï¼š
                // { choices: [{ message: { content: "å›ç­”å†…å®¹" } }] }
                // ============================================
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const answer = data.choices[0].message.content;
                    
                    // å°†AIå›å¤æ·»åŠ åˆ°å¯¹è¯å†å²
                    if (useHistory) {
                        conversationHistory.push({
                            role: 'assistant',
                            content: answer
                        });
                        // ä¿å­˜å¯¹è¯å†å²
                        saveConversationHistory();
                    }
                    
                    return answer;
                } else {
                    // å¦‚æœæ ¼å¼ä¸åŒ¹é…ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯
                    console.error('æ„å¤–çš„APIå“åº”æ ¼å¼:', data);
                    throw new Error('APIè¿”å›æ ¼å¼å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥å“åº”æ•°æ®');
                }
            } catch (error) {
                // å¦‚æœå‡ºé”™ï¼Œå›æ»šæœ€åæ·»åŠ çš„ç”¨æˆ·æ¶ˆæ¯
                if (useHistory && conversationHistory.length > 0 && conversationHistory[conversationHistory.length - 1].role === 'user') {
                    conversationHistory.pop();
                }
                console.error('DeepSeek API è°ƒç”¨é”™è¯¯:', error);
                throw error;
            }
        }

        // æäº¤é—®é¢˜çš„å‡½æ•°ï¼ˆå¯è¢«è¡¨å•æäº¤å’Œå›è½¦é”®è°ƒç”¨ï¼‰
        // skipHistory: æ˜¯å¦è·³è¿‡ä¿å­˜å†å²è®°å½•ï¼ˆç”¨äºçŒå¤´æ¨¡å¼ç­‰ç‰¹æ®Šåœºæ™¯ï¼‰
        async function submitQuestion(skipHistory = false) {
            const question = questionInput.value.trim();
            if (!question) {
                await customAlert('è¯·è¾“å…¥é—®é¢˜ï¼', 'æç¤º');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            submitBtn.disabled = true;
            submitText.style.display = 'none';
            loadingText.style.display = 'inline';
            answerSection.style.display = 'none';
            answerContent.innerHTML = '';

            try {
                // è°ƒç”¨APIè·å–å›ç­”
                const answer = await getAnswer(question);
                
                // æ˜¾ç¤ºå›ç­”
                answerContent.innerHTML = answer.replace(/\n/g, '<br>');
                answerSection.style.display = 'block';
                
                // åªæœ‰åœ¨ä¸è·³è¿‡å†å²è®°å½•æ—¶æ‰ä¿å­˜
                if (!skipHistory) {
                    saveToHistory(question, answer);
                }
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                questionInput.value = '';
                
                // æ»šåŠ¨åˆ°å›ç­”åŒºåŸŸ
                answerSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
            } catch (error) {
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                answerContent.innerHTML = `<div style="color: var(--primary-color);">é”™è¯¯: ${error.message}<br><br>è¯·æ£€æŸ¥ï¼š<br>1. API URLæ˜¯å¦æ­£ç¡®<br>2. API Keyæ˜¯å¦æœ‰æ•ˆ<br>3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸<br>4. APIå“åº”æ ¼å¼æ˜¯å¦åŒ¹é…</div>`;
                answerSection.style.display = 'block';
                console.error('è·å–å›ç­”å¤±è´¥:', error);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                submitBtn.disabled = false;
                submitText.style.display = 'inline';
                loadingText.style.display = 'none';
            }
        }

        // å¤„ç†è¡¨å•æäº¤
        if (qaForm) {
            qaForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await submitQuestion();
            });
        }

        // æ·»åŠ å›è½¦é”®å‘é€åŠŸèƒ½ï¼ˆShift+Enter æ¢è¡Œï¼ŒEnter å‘é€ï¼‰
        if (questionInput) {
            questionInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    // å¦‚æœæŒ‰é’®æ²¡æœ‰è¢«ç¦ç”¨ï¼Œåˆ™æäº¤
                    if (!submitBtn.disabled) {
                        submitQuestion();
                    }
                }
            });
        }

        // çŒå¤´æ¨¡å¼æŒ‰é’®
        const hunterModeBtn = document.getElementById('hunterModeBtn');
        if (hunterModeBtn) {
            hunterModeBtn.addEventListener('click', async () => {
                // å¦‚æœå·²ç»åœ¨çŒå¤´æ¨¡å¼ä¸­ï¼Œç‚¹å‡»åé€€å‡º
                if (isHunterMode) {
                    exitHunterMode();
                    await customAlert('å·²é€€å‡ºçŒå¤´æ¨¡å¼', 'æç¤º');
                    return;
                }

                // è®¾ç½®çŒå¤´æ¨¡å¼çš„æ¶ˆæ¯
                const hunterMessage = 'æˆ‘æ˜¯ä¸€ä¸ªçŒå¤´ï¼Œä½ ç°åœ¨æ˜¯æˆ‘çš„åŠ©æ‰‹ï¼Œç°åœ¨å¼€å§‹ä½ å«å°çŒï¼Œä½ çš„å·¥ä½œæ˜¯å¸®æˆ‘å¤„ç†å·¥ä½œä¸Šé‡åˆ°çš„é—®é¢˜ã€‚å¹¶ä¸”ç»™äºˆæˆ‘å¯¹åº”çš„å›ç­”å¸®åŠ©ã€‚';
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼ˆä¸å¡«å…¥è¾“å…¥æ¡†ï¼‰
                submitBtn.disabled = true;
                submitText.style.display = 'none';
                loadingText.style.display = 'inline';
                answerSection.style.display = 'none';
                answerContent.innerHTML = '';

                try {
                    // ç›´æ¥è°ƒç”¨APIè·å–å›ç­”ï¼ˆä¸æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸­ï¼Œä¸ä½¿ç”¨å†å²è®°å½•ï¼‰
                    // useHistory = false è¡¨ç¤ºä¸ä¿å­˜åˆ°å¯¹è¯å†å²ï¼Œä¹Ÿä¸ä½¿ç”¨ä¹‹å‰çš„å¯¹è¯å†å²
                    const answer = await getAnswer(hunterMessage, false);
                    
                    // æ˜¾ç¤ºå›ç­”
                    answerContent.innerHTML = answer.replace(/\n/g, '<br>');
                    answerSection.style.display = 'block';
                    
                    // è¿›å…¥çŒå¤´æ¨¡å¼
                    isHunterMode = true;
                    updateHunterModeButton();
                    
                    // ä¸ä¿å­˜åˆ°å†å²è®°å½•ï¼ˆskipHistory = trueï¼‰
                    // ä¸æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸­ï¼ˆä»æœªå¡«å…¥ï¼‰
                    // ä¸ä½¿ç”¨å¯¹è¯å†å²ï¼ˆuseHistory = falseï¼‰
                    
                    // æ»šåŠ¨åˆ°å›ç­”åŒºåŸŸ
                    answerSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                } catch (error) {
                    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    answerContent.innerHTML = `<div style="color: var(--primary-color);">é”™è¯¯: ${error.message}<br><br>è¯·æ£€æŸ¥ï¼š<br>1. API URLæ˜¯å¦æ­£ç¡®<br>2. API Keyæ˜¯å¦æœ‰æ•ˆ<br>3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸<br>4. APIå“åº”æ ¼å¼æ˜¯å¦åŒ¹é…</div>`;
                    answerSection.style.display = 'block';
                    console.error('è·å–å›ç­”å¤±è´¥:', error);
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitBtn.disabled = false;
                    submitText.style.display = 'inline';
                    loadingText.style.display = 'none';
                }
            });
        }

        // æ¸…ç©ºå¯¹è¯å†å²ï¼ˆæ¸…ç©ºAIçš„è®°å¿†ï¼‰
        const clearConversationBtn = document.getElementById('clearConversationBtn');
        // å§‹ç»ˆæ˜¾ç¤ºæ¸…ç©ºå¯¹è¯æŒ‰é’®ï¼ˆå› ä¸ºå¯èƒ½å¤„äºçŒå¤´æ¨¡å¼ä¸­ï¼‰
        if (clearConversationBtn) {
            clearConversationBtn.style.display = 'block';
            clearConversationBtn.addEventListener('click', async () => {
                const confirmed = await customConfirm('ç¡®å®šè¦æ¸…ç©ºå¯¹è¯å†å²å—ï¼Ÿè¿™å°†æ¸…é™¤AIçš„è®°å¿†ï¼Œä½†ä¸ä¼šåˆ é™¤å†å²é—®ç­”è®°å½•ã€‚', 'æ¸…ç©ºå¯¹è¯å†å²');
                if (confirmed) {
                    // æ¸…ç©ºå›ç­”æ˜¾ç¤ºåŒºåŸŸ
                    if (answerSection) {
                        answerSection.style.display = 'none';
                    }
                    if (answerContent) {
                        answerContent.innerHTML = '';
                    }
                    
                    clearConversationHistory();
                    await customAlert('å¯¹è¯å†å²å·²æ¸…ç©ºï¼ŒAIå°†é‡æ–°å¼€å§‹å¯¹è¯ã€‚', 'æç¤º');
                }
            });
        }

        // æ¸…ç©ºå†å²è®°å½•ï¼ˆæ¸…ç©ºæ˜¾ç¤ºçš„å†å²é—®ç­”å’Œå¯¹è¯å†å²æ•°ç»„ï¼‰
        if (clearHistoryBtn) {
            clearHistoryBtn.addEventListener('click', async () => {
                const confirmed = await customConfirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿè¿™å°†æ¸…é™¤å†å²é—®ç­”è®°å½•å’ŒAIçš„å¯¹è¯è®°å¿†ã€‚', 'æ¸…ç©ºå†å²è®°å½•');
                if (confirmed) {
                    // æ¸…é™¤æ˜¾ç¤ºçš„å†å²é—®ç­”è®°å½•
                    localStorage.removeItem('qaHistory');
                    historyList.innerHTML = '';
                    clearHistoryBtn.style.display = 'none';
                    
                    // æ¸…ç©ºå›ç­”æ˜¾ç¤ºåŒºåŸŸ
                    if (answerSection) {
                        answerSection.style.display = 'none';
                    }
                    if (answerContent) {
                        answerContent.innerHTML = '';
                    }
                    
                    // åŒæ—¶æ¸…é™¤å¯¹è¯å†å²æ•°ç»„ï¼ˆè®©AIå¤±å»è®°å¿†ï¼‰
                    clearConversationHistory();
                }
            });
        }

        // é¡µé¢åŠ è½½æ—¶åŠ è½½å¯¹è¯å†å²å’Œå†å²è®°å½•
        loadConversationHistory();
        loadHistory();
        
        // åˆå§‹åŒ–çŒå¤´æ¨¡å¼æŒ‰é’®çŠ¶æ€
        updateHunterModeButton();
    </script>
</body>
</html>



